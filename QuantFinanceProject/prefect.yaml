# prefect.yaml

prefect-version: "3"

deployments:
  # --- ADDED: This new deployment will run once daily to refresh the token ---
  - name: daily-token-refresh
    path: /app
    entrypoint: flows/refresh_token_flow.py:refresh_token_flow
    work_pool: { name: default-agent-pool, type: process }
    work_dir: /app
    schedule:
      cron: "30 8 * * 1-5" # Runs at 8:30 AM IST on weekdays
      timezone: "Asia/Kolkata"
  # -------------------------------------------------------------------------

  - name: bootstrap-historical
    path: /app
    entrypoint: flows/marketdata_flows.py:bootstrap_flow
    work_pool: { name: default-agent-pool, type: process }
    work_dir: /app
    infra_overrides: { working_dir: /app }

  - name: daily-eod
    path: /app
    entrypoint: flows/marketdata_flows.py:update_daily_flow
    work_pool: { name: default-agent-pool, type: process }
    work_dir: /app
    infra_overrides: { working_dir: /app }
    schedule: { cron: "0 16 * * 1-5", timezone: "Asia/Kolkata" }

  - name: intraday-rollup-5m
    path: /app
    entrypoint: flows/marketdata_flows.py:update_5m_flow
    work_pool: { name: default-agent-pool, type: process }
    work_dir: /app
    infra_overrides: { working_dir: /app }
    schedule: { cron: "0 16 * * 1-5", timezone: "Asia/Kolkata" }
  - name: earnings-ingestion-xbrl
    path: /app
    entrypoint: flows/earnings_data_flows.py:simplified_ingestion_flow
    work_pool: { name: default-agent-pool, type: process }
    work_dir: /app
    infra_overrides: { working_dir: /app }